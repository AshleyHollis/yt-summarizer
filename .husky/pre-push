#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Frontend checks (if web app changed)
echo "ğŸ” Running pre-push checks..."

# Check if frontend files changed
FRONTEND_CHANGED=$(git diff --name-only @{push}..HEAD | grep -c '^apps/web/' || true)

if [ "$FRONTEND_CHANGED" -gt 0 ]; then
  echo "ğŸ“¦ Frontend changes detected - running comprehensive checks..."

  cd apps/web || exit 1

  # Run lint
  echo "  â”œâ”€ Running ESLint..."
  npm run lint || { echo "  â”‚  âŒ ESLint failed!"; exit 1; }
  echo "  â”‚  âœ… ESLint passed"

  # Run TypeScript check
  echo "  â”œâ”€ Running TypeScript check..."
  npx tsc --noEmit || { echo "  â”‚  âŒ TypeScript check failed!"; exit 1; }
  echo "  â”‚  âœ… TypeScript check passed"

  # Run build
  echo "  â”œâ”€ Running build..."
  npm run build || { echo "  â”‚  âŒ Build failed!"; exit 1; }
  echo "  â”‚  âœ… Build passed"

  # Run tests
  echo "  â””â”€ Running tests..."
  npm run test:run || { echo "     âŒ Tests failed!"; exit 1; }
  echo "     âœ… Tests passed"

  cd ../.. || exit 1
fi

echo "âœ… All pre-push checks passed!"
