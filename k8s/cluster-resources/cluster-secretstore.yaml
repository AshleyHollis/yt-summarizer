# =============================================================================
# ClusterSecretStore for Azure Key Vault
# =============================================================================
# Shared across ALL namespaces - allows preview environments to access secrets
# without requiring individual federated identity credentials per namespace.
#
# Uses the production managed identity which has:
# - Federated credential for system:serviceaccount:yt-summarizer:yt-summarizer-sa
# - Access to Azure Key Vault secrets
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: azure-keyvault-cluster
  labels:
    app.kubernetes.io/name: yt-summarizer
    app.kubernetes.io/component: secrets
spec:
  provider:
    azurekv:
      # Azure Key Vault URL
      vaultUrl: "https://kv-ytsumm-prd.vault.azure.net/"
      # Use Workload Identity authentication
      authType: WorkloadIdentity
      serviceAccountRef:
        # Reference the production namespace's ServiceAccount
        # This SA has the federated identity credential configured
        name: yt-summarizer-sa
        namespace: yt-summarizer
