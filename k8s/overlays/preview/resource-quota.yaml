# =============================================================================
# Preview ResourceQuota
# =============================================================================
# Limits total resources consumed by preview environment
# Protects production namespace on shared single-node AKS cluster
#
# Resource calculation (5 deployments at 256Mi limit, 200m CPU limit each):
# - API: 256Mi mem, 200m CPU
# - transcribe-worker: 256Mi mem, 200m CPU
# - summarize-worker: 256Mi mem, 200m CPU
# - embed-worker: 256Mi mem, 200m CPU
# - relationships-worker: 256Mi mem, 200m CPU
# Total: 1280Mi mem (~2.0Gi with headroom), 1000m CPU (~1.5 with headroom)
apiVersion: v1
kind: ResourceQuota
metadata:
  name: preview-quota
spec:
  hard:
    # CPU limits (5 pods x 200m = 1000m, plus headroom)
    requests.cpu: "750m"
    limits.cpu: "1500m"
    # Memory limits (5 pods x 256Mi = 1280Mi, plus headroom)
    requests.memory: "750Mi"
    limits.memory: "2048Mi"
    # Pod count limit
    pods: "10"
    # Prevent excessive services
    services: "5"
    # Prevent excessive secrets
    secrets: "10"
    # Prevent excessive configmaps
    configmaps: "10"
