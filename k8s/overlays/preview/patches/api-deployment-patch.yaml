# =============================================================================
# Preview API Deployment Patch (strategic merge)
# =============================================================================
# Adds preview-specific configuration for CORS origins as a strategic-merge
# patch so kustomize can apply it when referenced in the overlay `patches:` list.
#
# This patch targets the `Deployment` named `api` and appends an env var that
# sets API__CORS_ORIGINS (JSON array string) so the service allows the SWA origin.
# The https://red-grass-06d413100-106.eastasia.6.azurestaticapps.net placeholder is replaced by CI during deployment.
# =============================================================================
apiVersion: apps/v1
kind: Deployment
metadata:
  name: api
  namespace: yt-summarizer
spec:
  template:
    spec:
      containers:
        - name: api
          env:
            - name: API__CORS_ORIGINS
              # JSON array string - keep no spaces after commas
              value: '["https://red-grass-06d413100-106.eastasia.6.azurestaticapps.net","http://localhost:3000"]'
