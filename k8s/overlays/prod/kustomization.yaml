# Generated by update_prod_kustomization.sh on 2026-02-28 12:13:21 UTC
# Image Tag: sha-d91b2b1


# =============================================================================
# Production Overlay Kustomization Template
# =============================================================================
# This is a template for the production kustomization.yaml
# The script will load this and update image tags
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: yt-summarizer

resources:
  - ../../base
  - priority-class.yaml

# Image tags - updated by deploy-prod.yml workflow on merge
# Using digest pinning for immutable deployments
images:
  - name: yt-summarizer-api
    newName: acrytsummprd.azurecr.io/yt-summarizer-api
    newTag: sha-d91b2b1
  - name: yt-summarizer-workers
    newName: acrytsummprd.azurecr.io/yt-summarizer-workers
    newTag: sha-d91b2b1

# Production-specific patches (all inline for consistency)
patches:
  # ConfigMap patch - production environment variables
  - target:
      version: v1
      kind: ConfigMap
      name: yt-summarizer-config
    patch: |-
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: yt-summarizer-config
        namespace: yt-summarizer
      data:
        ENVIRONMENT: "production"
        LOG_LEVEL: "INFO"
  # HTTPRoute patch - production hostname
  - target:
      group: gateway.networking.k8s.io
      version: v1
      kind: HTTPRoute
      name: api-httproute
    patch: |-
      apiVersion: gateway.networking.k8s.io/v1
      kind: HTTPRoute
      metadata:
        name: api-httproute
        labels:
          app.kubernetes.io/environment: production
        annotations:
          external-dns.alpha.kubernetes.io/hostname: api.yt-summarizer.apps.ashleyhollis.com
      spec:
        hostnames:
        - "api.yt-summarizer.apps.ashleyhollis.com"
  # Production resource requests/limits per deployment
  - target:
      group: apps
      version: v1
      kind: Deployment
      name: api
    patch: |-
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: api
      spec:
        template:
          spec:
            containers:
              - name: api
                resources:
                  requests:
                    cpu: 25m
                    memory: 128Mi
                  limits:
                    cpu: 500m
                    memory: 512Mi
  - target:
      group: apps
      version: v1
      kind: Deployment
      name: transcribe-worker
    patch: |-
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: transcribe-worker
      spec:
        template:
          spec:
            containers:
              - name: worker
                resources:
                  requests:
                    cpu: 25m
                    memory: 128Mi
                  limits:
                    cpu: 500m
                    memory: 512Mi
  - target:
      group: apps
      version: v1
      kind: Deployment
      name: summarize-worker
    patch: |-
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: summarize-worker
      spec:
        template:
          spec:
            containers:
              - name: worker
                resources:
                  requests:
                    cpu: 25m
                    memory: 128Mi
                  limits:
                    cpu: 500m
                    memory: 512Mi
  - target:
      group: apps
      version: v1
      kind: Deployment
      name: embed-worker
    patch: |-
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: embed-worker
      spec:
        template:
          spec:
            containers:
              - name: worker
                resources:
                  requests:
                    cpu: 25m
                    memory: 128Mi
                  limits:
                    cpu: 500m
                    memory: 512Mi
  - target:
      group: apps
      version: v1
      kind: Deployment
      name: relationships-worker
    patch: |-
      apiVersion: apps/v1
      kind: Deployment
      metadata:
        name: relationships-worker
      spec:
        template:
          spec:
            containers:
              - name: worker
                resources:
                  requests:
                    cpu: 25m
                    memory: 128Mi
                  limits:
                    cpu: 500m
                    memory: 512Mi

labels:
  - pairs:
      environment: production
      app.kubernetes.io/part-of: yt-summarizer

commonAnnotations:
  deployment.kubernetes.io/environment: production
