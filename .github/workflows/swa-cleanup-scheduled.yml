# =============================================================================
# Scheduled SWA Environment Cleanup
# =============================================================================
# Runs daily to clean up stale Azure Static Web Apps staging environments
# for PRs that have been closed/merged

name: SWA Cleanup (Scheduled)

on:
  schedule:
    # Run daily at 2 AM UTC
    - cron: '0 2 * * *'
  workflow_dispatch:
    inputs:
      dry-run:
        description: 'Dry run mode (no actual deletion)'
        required: false
        type: boolean
        default: true

permissions:
  id-token: write
  contents: read
  pull-requests: read

jobs:
  cleanup-stale-environments:
    name: Cleanup Stale SWA Environments
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Find and cleanup stale SWA environments
        uses: ./.github/actions/cleanup-stale-swa-environments
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          swa-deployment-token: ${{ secrets.SWA_DEPLOYMENT_TOKEN }}
          dry-run: ${{ github.event.inputs.dry-run || 'false' }}
          min-age-hours: '1'
          max-prs-to-check: '100'
