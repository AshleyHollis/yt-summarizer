# Simple SWA deployment for baseline warmup testing
# This workflow bypasses all the complex orchestration to test SWA in isolation

name: SWA Baseline Deploy

on:
  workflow_dispatch:
    inputs:
      pr_number:
        description: 'PR number to deploy'
        required: true
        type: string
  push:
    branches:
      - test/swa-warmup-baseline

jobs:
  deploy-swa:
    name: Deploy SWA Baseline
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: ./.github/actions/setup-node
        with:
          node-version: "20"
          working-directory: apps/web

      - name: Build frontend
        working-directory: apps/web
        env:
          # Use empty/placeholder API URL for baseline test
          NEXT_PUBLIC_API_URL: "https://api-placeholder.example.com"
          NEXT_PUBLIC_ENVIRONMENT: "preview"
        run: |
          echo "Building Next.js app..."
          npm run build

      - name: Azure Login
        uses: azure/login@v2
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}

      - name: Deploy to SWA
        id: deploy
        uses: Azure/static-web-apps-deploy@v1
        with:
          azure_static_web_apps_api_token: ${{ secrets.SWA_DEPLOYMENT_TOKEN }}
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          action: upload
          app_location: apps/web
          output_location: ""
          skip_app_build: true
          production_branch: main

      - name: Report deployment URL
        run: |
          echo "‚úÖ SWA Deployment completed"
          echo "üìç URL: ${{ steps.deploy.outputs.static_web_app_url }}"
