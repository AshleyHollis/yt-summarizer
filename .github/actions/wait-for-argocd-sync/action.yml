name: Wait for Argo CD Sync
description: Wait for Argo CD to sync and create the preview namespace

inputs:
  namespace:
    description: Kubernetes namespace to wait for
    required: true
  pr-number:
    description: Pull request number (for diagnostics)
    required: true
  timeout-seconds:
    description: Maximum time to wait in seconds
    required: false
    default: '180'

runs:
  using: composite
  steps:
    - name: Wait for Argo CD sync and gather diagnostics
      shell: bash
      env:
        NAMESPACE: ${{ inputs.namespace }}
        PR_NUMBER: ${{ inputs.pr-number }}
        TIMEOUT_SECONDS: ${{ inputs.timeout-seconds }}
        INTERVAL: 5
      run: bash ${{ github.action_path }}/script.sh
