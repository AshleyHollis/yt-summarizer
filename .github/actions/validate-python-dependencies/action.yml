# Validate Python Dependencies
# Scans codebase for missing/unused/vulnerable dependencies
# Uses industry-standard tools: deptry, pip-audit, pipdeptree

name: 'Validate Python Dependencies'
description: 'Scan for missing dependencies, unused dependencies, and security vulnerabilities'

inputs:
  service-path:
    description: 'Path to the service directory (e.g., services/api)'
    required: true
  check-missing:
    description: 'Check for missing dependencies (imports not in pyproject.toml)'
    required: false
    default: 'true'
  check-unused:
    description: 'Check for unused dependencies (in pyproject.toml but never imported)'
    required: false
    default: 'false'
  check-security:
    description: 'Check for security vulnerabilities in dependencies'
    required: false
    default: 'true'
  fail-on-warnings:
    description: 'Fail if warnings are found'
    required: false
    default: 'false'

runs:
  using: 'composite'
  steps:
    - name: Validate Python dependencies
      shell: bash
      env:
        SERVICE_PATH: ${{ inputs.service-path }}
        CHECK_MISSING: ${{ inputs.check-missing }}
        CHECK_UNUSED: ${{ inputs.check-unused }}
        CHECK_SECURITY: ${{ inputs.check-security }}
        FAIL_ON_WARNINGS: ${{ inputs.fail-on-warnings }}
      run: ${{ github.action_path }}/script.sh
