<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Terraform Plan - Run #42</title>

  <!-- GitHub Primer CSS - the actual styles GitHub uses -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.5.1/github-markdown-light.min.css">

  <!-- marked.js for GitHub Flavored Markdown parsing -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <style>
    /* Match GitHub's PR comment container */
    body {
      background: #ffffff;
      padding: 0;
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
    }

    .github-container {
      max-width: 1012px;
      margin: 0 auto;
      padding: 32px 16px;
    }

    /* Mode toggle */
    .mode-toggle {
      position: fixed;
      top: 16px;
      right: 16px;
      display: flex;
      gap: 8px;
      z-index: 100;
    }

    .mode-toggle button {
      padding: 8px 16px;
      border: 1px solid #d0d7de;
      background: #f6f8fa;
      color: #24292f;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }

    .mode-toggle button:hover {
      background: #eaeef2;
    }

    .mode-toggle button.active {
      background: #0969da;
      color: white;
      border-color: #0969da;
    }

    /* GitHub PR comment styling */
    .pr-comment {
      border: 1px solid #d0d7de;
      border-radius: 6px;
      background: #ffffff;
    }

    .pr-comment-header {
      padding: 8px 16px;
      background: #f6f8fa;
      border-bottom: 1px solid #d0d7de;
      border-radius: 6px 6px 0 0;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: #57606a;
    }

    .pr-comment-header img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
    }

    .pr-comment-header strong {
      color: #24292f;
    }

    .pr-comment-body {
      padding: 16px;
    }

    /* Apply GitHub markdown styles */
    .markdown-body {
      box-sizing: border-box;
      min-width: 200px;
      max-width: 980px;
      margin: 0 auto;
    }

    /* Fix for GitHub alerts/callouts */
    .markdown-body blockquote {
      margin: 16px 0;
      padding: 0 1em;
      color: #57606a;
      border-left: 0.25em solid #d0d7de;
    }

    /* GitHub-style note/warning/caution boxes */
    .markdown-body blockquote p:first-child {
      margin-top: 0;
    }

    /* GitHub alerts styling */
    .markdown-body > blockquote:has(p:first-child:contains("[!NOTE]")),
    .markdown-body > blockquote:has(p:first-child:contains("[!WARNING]")),
    .markdown-body > blockquote:has(p:first-child:contains("[!IMPORTANT]")),
    .markdown-body > blockquote:has(p:first-child:contains("[!CAUTION]")) {
      padding: 8px 16px;
      border-radius: 6px;
    }

    /* GitHub diff code block highlighting */
    .markdown-body pre code .diff-addition,
    .markdown-body pre code .hljs-addition {
      background-color: rgba(46, 160, 67, 0.15);
      display: block;
    }

    .markdown-body pre code .diff-deletion,
    .markdown-body pre code .hljs-deletion {
      background-color: rgba(248, 81, 73, 0.15);
      display: block;
    }

    /* Custom diff line highlighting - inline spans without extra spacing */
    .diff-add {
      background-color: rgba(46, 160, 67, 0.25);
    }

    .diff-delete {
      background-color: rgba(248, 81, 73, 0.25);
    }

    .diff-change {
      background-color: rgba(210, 153, 34, 0.25);
    }

    /* Info box for preview mode */
    .preview-info {
      background: #f6f8fa;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      padding: 16px;
      margin-bottom: 24px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .preview-info-icon {
      font-size: 24px;
    }

    .preview-info-text {
      flex: 1;
    }

    .preview-info-title {
      font-weight: 600;
      color: #24292f;
      margin-bottom: 4px;
    }

    .preview-info-desc {
      font-size: 14px;
      color: #57606a;
    }
  </style>
</head>
<body>
  <div class="mode-toggle">
    <button onclick="location.href='?mode=light'" class="active">â˜€ï¸ Light</button>
    <button onclick="location.href='?mode=dark'" class="">ğŸŒ™ Dark</button>
  </div>

  <div class="github-container">
    <div class="preview-info">
      <div class="preview-info-icon">ğŸ”</div>
      <div class="preview-info-text">
        <div class="preview-info-title">GitHub Preview Mode</div>
        <div class="preview-info-desc">This preview uses GitHub's actual Primer CSS and marked.js GFM renderer. What you see here is exactly what will appear on GitHub.</div>
      </div>
    </div>

    <div class="pr-comment">
      <div class="pr-comment-header">
        <img src="https://avatars.githubusercontent.com/in/15368?s=64&v=4" alt="github-actions[bot]">
        <span><strong>github-actions</strong> bot commented just now</span>
      </div>
      <div class="pr-comment-body">
        <article class="markdown-body" id="content">
          <!-- Markdown will be rendered here -->
        </article>
      </div>
    </div>
  </div>

  <script>
    // Configure marked for GitHub Flavored Markdown
    marked.setOptions({
      gfm: true,           // GitHub Flavored Markdown
      breaks: false,       // GitHub doesn't convert \n to <br>
      headerIds: true,     // Add IDs to headers
      mangle: false,       // Don't mangle email addresses
      pedantic: false,
      sanitize: false,     // Allow HTML (GitHub allows it in comments)
      smartLists: true,
      smartypants: false,
      xhtml: false
    });

    // The markdown content
    const markdown = `<!-- terraform-plan-comment -->

# âœ… Terraform Plan

> ğŸ“‹ **Run [#42](https://github.com/AshleyHollis/yt-summarizer/actions/runs/12345)** Â· 2026-01-13 08:48:50 UTC Â· @developer

![add](https://img.shields.io/badge/add-7-2eb039?style=flat-square) ![change](https://img.shields.io/badge/change-12-d4a017?style=flat-square) ![destroy](https://img.shields.io/badge/destroy-1-c62b2b?style=flat-square)

\`\`\`diff
+ 7 to add
! 12 to change
- 1 to destroy
\`\`\`


### â• Resources to Create Â· 7


<details>
<summary>ğŸŸ¢ <code>module.github_oidc.azuread_application.github_actions</code></summary>

\`\`\`diff
+ resource "azuread_application" "github_actions" {
      description = "Service principal for GitHub Actions OIDC authentication"
      display_name = "GitHub Actions OIDC"
      sign_in_audience = "AzureADMyOrg"
}
\`\`\`

</details>

<details>
<summary>ğŸŸ¢ <code>module.github_oidc.azuread_application_federated_identity_credential.main</code></summary>

\`\`\`diff
+ resource "azuread_application_federated_identity_credential" "main" {
       audiences = ["api://AzureADTokenExchange"]
      description = "Federated credential for main branch"
      display_name = "github-oidc-main"
      issuer = "https://token.actions.githubusercontent.com"
      subject = "repo:AshleyHollis/yt-summarizer:ref:refs/heads/main"
}
\`\`\`

</details>

<details>
<summary>ğŸŸ¢ <code>module.github_oidc.azuread_application_federated_identity_credential.production</code></summary>

\`\`\`diff
+ resource "azuread_application_federated_identity_credential" "production" {
       audiences = ["api://AzureADTokenExchange"]
      description = "Federated credential for production environment"
      display_name = "github-oidc-production"
      issuer = "https://token.actions.githubusercontent.com"
      subject = "repo:AshleyHollis/yt-summarizer:environment:production"
}
\`\`\`

</details>

<details>
<summary>ğŸŸ¢ <code>module.github_oidc.azuread_application_federated_identity_credential.pull_request</code></summary>

\`\`\`diff
+ resource "azuread_application_federated_identity_credential" "pull_request" {
       audiences = ["api://AzureADTokenExchange"]
      description = "Federated credential for pull requests"
      display_name = "github-oidc-pull-request"
      issuer = "https://token.actions.githubusercontent.com"
      subject = "repo:AshleyHollis/yt-summarizer:pull_request"
}
\`\`\`

</details>

<details>
<summary>ğŸŸ¢ <code>module.github_oidc.azuread_service_principal.github_actions</code></summary>

\`\`\`diff
+ resource "azuread_service_principal" "github_actions" {
      description = "Service principal for GitHub Actions"
}
\`\`\`

</details>

<details>
<summary>ğŸŸ¢ <code>module.github_oidc.azurerm_role_assignment.acr_push[0]</code></summary>

\`\`\`diff
+ resource "azurerm_role_assignment" "acr_push" {
      role_definition_name = "AcrPush"
      scope = "/subscriptions/12345678-1234-1234-1234-123456789abc/resourceGroups/yt-summarizer-rg/providers/Microsoft.ContainerRegistry/registries/ytsummarizerregistry"
}
\`\`\`

</details>

<details>
<summary>ğŸŸ¢ <code>module.github_oidc.azurerm_role_assignment.contributor[0]</code></summary>

\`\`\`diff
+ resource "azurerm_role_assignment" "contributor" {
      role_definition_name = "Contributor"
      scope = "/subscriptions/12345678-1234-1234-1234-123456789abc/resourceGroups/yt-summarizer-rg"
}
\`\`\`

</details>


### ğŸ”„ Resources to Replace Â· 1


<details>
<summary>ğŸŸ£ <code>module.cdn.azurerm_cdn_profile.profile</code></summary>

\`\`\`diff
-/+ resource "azurerm_cdn_profile" "profile" {
    # forces replacement
!!     sku = "Standard_Verizon" -> "Standard_Microsoft"
}
\`\`\`

</details>


### âœï¸ Resources to Update Â· 11


<details>
<summary>ğŸŸ¡ <code>module.acr.azurerm_container_registry.acr</code></summary>

\`\`\`diff
~ resource "azurerm_container_registry" "acr" {
!     sku = "Basic" -> "Standard"
!     tags {
+         managed-by = "terraform"
!     }
}
\`\`\`

</details>

<details>
<summary>ğŸŸ¡ <code>module.aks.azurerm_kubernetes_cluster.aks</code></summary>

\`\`\`diff
~ resource "azurerm_kubernetes_cluster" "aks" {
!     default_node_pool {
!         node_count = 2 -> 3
!     }
!     kubernetes_version = "1.28.5" -> "1.29.0"
}
\`\`\`

</details>

<details>
<summary>ğŸŸ¡ <code>module.key_vault.azurerm_key_vault_secret.secrets["sql-connection-string"]</code></summary>

\`\`\`diff
~ resource "azurerm_key_vault_secret" "secrets" {
!     content_type = "text/plain" -> "application/x-connection-string"
!     expiration_date = null -> "2025-12-31T23:59:59Z"
}
\`\`\`

</details>

<details>
<summary>ğŸŸ¡ <code>module.sql.azurerm_mssql_database.database</code></summary>

\`\`\`diff
~ resource "azurerm_mssql_database" "database" {
!     max_size_gb = 2 -> 10
!     sku_name = "Basic" -> "S0"
!     storage_account_type = "Local" -> "Geo"
}
\`\`\`

</details>

<details>
<summary>ğŸŸ¡ <code>module.sql.azurerm_mssql_server.server</code></summary>

\`\`\`diff
~ resource "azurerm_mssql_server" "server" {
!     minimum_tls_version = "1.0" -> "1.2"
!     public_network_access_enabled = true -> false
}
\`\`\`

</details>

<details>
<summary>ğŸŸ¡ <code>module.storage.azurerm_storage_account.storage</code></summary>

\`\`\`diff
~ resource "azurerm_storage_account" "storage" {
!     account_replication_type = "LRS" -> "GRS"
}
\`\`\`

</details>

<details>
<summary>ğŸŸ¡ <code>module.storage.azurerm_storage_container.containers["embeddings"]</code></summary>

\`\`\`diff
~ resource "azurerm_storage_container" "containers" {
!     container_access_type = "private" -> "blob"
}
\`\`\`

</details>

<details>
<summary>ğŸŸ¡ <code>module.storage.azurerm_storage_container.containers["summaries"]</code></summary>

\`\`\`diff
~ resource "azurerm_storage_container" "containers" {
!     container_access_type = "private" -> "blob"
}
\`\`\`

</details>

<details>
<summary>ğŸŸ¡ <code>module.storage.azurerm_storage_container.containers["transcripts"]</code></summary>

\`\`\`diff
~ resource "azurerm_storage_container" "containers" {
!     container_access_type = "private" -> "blob"
}
\`\`\`

</details>

<details>
<summary>ğŸŸ¡ <code>module.storage.azurerm_storage_queue.queues["embed-queue"]</code></summary>

\`\`\`diff
~ resource "azurerm_storage_queue" "queues" {
+     metadata {
+         purpose = "embedding-jobs"
+     }
}
\`\`\`

</details>

<details>
<summary>ğŸŸ¡ <code>module.swa.azurerm_static_web_app.swa</code></summary>

\`\`\`diff
~ resource "azurerm_static_web_app" "swa" {
!     sku_size = "Free" -> "Standard"
!     sku_tier = "Free" -> "Standard"
}
\`\`\`

</details>


### ğŸ—‘ï¸ Resources to Destroy Â· 1


<details>
<summary>ğŸ”´ <code>module.key_vault.azurerm_role_assignment.secrets_officer[0]</code></summary>

\`\`\`diff
- resource "azurerm_role_assignment" "secrets_officer" {
      scope = "/subscriptions/12345678-1234-1234-1234-123456789abc/resourceGroups/yt-summarizer-rg/providers/Microsoft.KeyVault/vaults/ytsummarizerkv"
}
\`\`\`

</details>

---
<sub>ğŸ”— [View full workflow run](https://github.com/AshleyHollis/yt-summarizer/actions/runs/12345)</sub>
`;

    // Render markdown
    document.getElementById('content').innerHTML = marked.parse(markdown);

    // Apply diff highlighting to code blocks - wrap entire lines with background
    document.querySelectorAll('pre code').forEach(block => {
      const lines = block.innerHTML.split('\n');
      let hasDiffMarkers = false;

      const highlighted = lines.map(line => {
        const textContent = line.replace(/<[^>]*>/g, ''); // Strip HTML tags for checking
        const trimmed = textContent.trimStart();

        if (trimmed.startsWith('+') && !trimmed.startsWith('+++')) {
          hasDiffMarkers = true;
          return '<span class="diff-add">' + line + '</span>';
        } else if (trimmed.startsWith('-') && !trimmed.startsWith('---')) {
          hasDiffMarkers = true;
          return '<span class="diff-delete">' + line + '</span>';
        } else if (trimmed.startsWith('~') || trimmed.startsWith('!')) {
          hasDiffMarkers = true;
          return '<span class="diff-change">' + line + '</span>';
        }
        return line;
      });

      if (hasDiffMarkers) {
        block.innerHTML = highlighted.join('\n');
      }
    });

    // Handle dark/light mode from URL
    const urlParams = new URLSearchParams(window.location.search);
    const mode = urlParams.get('mode');
    if (mode === 'dark' && !false) {
      location.href = '?mode=dark';
    } else if (mode === 'light' && false) {
      location.href = '?mode=light';
    }
  </script>
</body>
</html>
