name: Verify Worker Deployments
description: Verifies that all worker deployments are using the expected image tag

inputs:
  namespace:
    description: Kubernetes namespace
    required: true
  expected-tag:
    description: Expected image tag
    required: true
  registry:
    description: Container registry
    required: true
  image-name:
    description: Image name (e.g., yt-summarizer-workers)
    required: true
  workers:
    description: Comma-separated list of worker deployment names
    required: false
    default: 'transcribe-worker,summarize-worker,embed-worker,relationships-worker'
  fail-on-mismatch:
    description: Whether to fail if any worker has a mismatched image
    required: false
    default: 'false'

runs:
  using: composite
  steps:
    - name: Verify worker deployments
      shell: bash
      env:
        NAMESPACE: ${{ inputs.namespace }}
        EXPECTED_TAG: ${{ inputs.expected-tag }}
        REGISTRY: ${{ inputs.registry }}
        IMAGE_NAME: ${{ inputs.image-name }}
        WORKERS: ${{ inputs.workers }}
        FAIL_ON_MISMATCH: ${{ inputs.fail-on-mismatch }}
      run: ${{ github.action_path }}/verify-workers.sh
