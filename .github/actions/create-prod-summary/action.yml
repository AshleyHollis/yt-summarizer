name: 'Create Production Deployment Summary'
description: 'Creates a GitHub Actions step summary for production deployments'
inputs:
  image-tag:
    description: 'Docker image tag deployed'
    required: true
  commit-sha:
    description: 'Git commit SHA'
    required: true
  update-overlay-result:
    description: 'Result of update-overlay job'
    required: true
  deploy-frontend-result:
    description: 'Result of deploy-frontend job'
    required: true
  health-check-result:
    description: 'Result of health-check job'
    required: true
runs:
  using: composite
  steps:
    - name: Generate summary
      shell: bash
      run: |
        echo "# ðŸš€ Production Deployment Summary" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "## Deployment Details" >> $GITHUB_STEP_SUMMARY
        echo "| Property | Value |" >> $GITHUB_STEP_SUMMARY
        echo "|----------|-------|" >> $GITHUB_STEP_SUMMARY
        echo "| **Image Tag** | \`${{ inputs.image-tag }}\` |" >> $GITHUB_STEP_SUMMARY
        echo "| **Commit** | \`${{ inputs.commit-sha }}\` |" >> $GITHUB_STEP_SUMMARY
        echo "| **Timestamp** | $(date -u +"%Y-%m-%d %H:%M:%S UTC") |" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        echo "## Job Status" >> $GITHUB_STEP_SUMMARY
        echo "| Job | Status |" >> $GITHUB_STEP_SUMMARY
        echo "|-----|--------|" >> $GITHUB_STEP_SUMMARY
        echo "| Update Overlay | ${{ inputs.update-overlay-result == 'success' && 'âœ… Success' || 'âŒ Failed' }} |" >> $GITHUB_STEP_SUMMARY
        echo "| Deploy Frontend | ${{ inputs.deploy-frontend-result == 'success' && 'âœ… Success' || 'âŒ Failed' }} |" >> $GITHUB_STEP_SUMMARY
        echo "| Health Check | ${{ inputs.health-check-result == 'success' && 'âœ… Success' || 'âŒ Failed' }} |" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY

        if [ "${{ inputs.update-overlay-result }}" = "success" ] && \
           [ "${{ inputs.deploy-frontend-result }}" = "success" ] && \
           [ "${{ inputs.health-check-result }}" = "success" ]; then
          echo "## âœ… Deployment Successful" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Production environment updated successfully." >> $GITHUB_STEP_SUMMARY
        else
          echo "## âŒ Deployment Failed" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "One or more deployment steps failed. Check job logs for details." >> $GITHUB_STEP_SUMMARY
        fi
